import { Meta, Story, Canvas, Props } from '@storybook/addon-docs'
import RecipesSchemaBuilder, { decode, data } from './RecipesSchemaBuilder'

<Meta
  title="Docs/Recipes/Elements/Input"
  component={RecipesSchemaBuilder}
  parameters={{
    docs: { source: { code: "" }}
  }}
/>

# Recipes

How to build specific form elements to use the hooks provided by `react-form-flow`.

## Input Field Recipe

The idea here is to show how to optimise your performance by reusing a input field.

## Code

Here, we are using [styled-components](https://www.styled-components.com/) for prettifying styles.

__src/ValidationResult.jsx__

You will probably need a component to display the validations, see the draft below.

```jsx
import React from 'react';
import styled from 'styled-components';

const ValidationResultLayout = styled.section`
  .ValidationResultLayout__message {
    color: red;
  }
`;

export default function ValidationResult({ errors = [] }) {
  return (
    <ValidationResultLayout>
      {validations.map(
        (validation) =>(
          <div className="ValidationResultLayout__message" key={validation.key}>
            {JSON.stringify(validation, null, 2)}
          </div>
        )
      )}
    </ValidationResultLayout>
  );
}
```

__src/InputField.jsx__

In the case below, validations are received always and the consumer decides when to display them.

**Note**: For this case, we are only displaying after visiting the field, but, nothing block you to pass another property `showValidation` when the form is submitted, then, it would be able to display by `{(isVisited || showValidation) && <ValidationResult validations={validations} />}`.

```jsx
import React, { useCallback, useRef, useState } from 'react';
import PropTypes from 'prop-types';
import uuid from 'uuid';
import styled from 'styled-components';
import ValidationResult from './ValidationResult';

const InputFieldLayout = styled.div`
  padding: 0 0 10px 0;
  label > span {
    display: block;
  }
  .InputFieldLayout__validations {
    display: block;
  }
`;

export default function InputField(props) {
  const {
    errors,
    field,
    label: labelText,
    submitted,
    touched,
  } = props
  const id = useRef(uuid.v4());

  return (
    <InputFieldLayout>
      <label htmlFor={id.current}>
        <span>{labelText}</span>
        <input id={id.current} type="text" {...field} />
      </label>
      <div className="InputFieldLayout__validations">
        {(submitted || touched) && <ValidationResult errors={errors} />}
      </div>
    </InputFieldLayout>
  );
}

InputField.defaultProps = {
  label: null,
  errors: [],
  value: '',
};
```

## Using the InputField

```jsx
import React, { useCallback, useRef, useState } from 'react';
import styled from 'styled-components';
import PropTypes from 'prop-types';
import uuid from 'uuid';
import { useFormFlowField } from 'react-form-flow';

const InputFieldRecipeLayout = styled.div`
  width: 100%;
`;

export default function InputFieldRecipe() {
  const nameField = useFormFlowField('name');

  return (
    <InputFieldRecipeLayout>
      <h2>Interact with the input field by focusing and leaving the field...</h2>

      <InputField {...nameField} label="Name" />
      <div>{nameField.value}</div>
    </InputFieldRecipeLayout>
  );
}
```

And then...

```jsx
  import { FormFlowProvider } from 'react-form-flow';

  const initialData = { ... };
  const schemaData = { ... };

  // ...

  <FormFlowProvider initialData={initialData} schemaData={schemaData}>
    <InputFieldRecipe />
  </FormFlowProvider>
```
