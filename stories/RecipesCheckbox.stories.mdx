import { Meta, Story, Canvas, Props } from '@storybook/addon-docs'
import RecipesSchemaBuilder, { decode, data } from './RecipesSchemaBuilder'

<Meta
  title="Docs/Recipes/Elements/Checkbox"
  component={RecipesSchemaBuilder}
  parameters={{
    docs: { source: { code: "" }}
  }}
/>

# Recipes

How to build specific form elements to use the hooks provided by `react-form-flow`.

## Checkbox Field

This recipe will show how to build a group/simple checkbox using the `input[type="checkbox"]` markup following the interface defined by `react-form-flow`.

## Code

Here, we are using [styled-components](https://www.styled-components.com/) for prettifying styles.

__src/ValidationResult.jsx__

You will probably need a component to display the validations, see the draft below.

```jsx
import React from 'react';
import styled from 'styled-components';

const ValidationResultLayout = styled.section`
  .ValidationResultLayout__message {
    color: red;
  }
`;

export default function ValidationResult({ errors = [] }) {
  return (
    <ValidationResultLayout>
      {validations.map(
        (validation) =>(
          <div className="ValidationResultLayout__message" key={validation.key}>
            {JSON.stringify(validation, null, 2)}
          </div>
        )
      )}
    </ValidationResultLayout>
  );
}
```

__src/CheckboxField.jsx__

Here, validations are received always and the consumer decides when to display them.

**Note**: For this case, we are displaying the validations straightaway, but, nothing block you to pass some property to control as it will be displayed. e.g. `showValidation` when the form is submitted, then, it would be able to display by `{showValidation && <ValidationResult validations={validations} />}`.

```jsx
import React, { useCallback, useRef, useState } from 'react';
import PropTypes from 'prop-types';
import uuid from 'uuid';
import styled from 'styled-components';
import ValidationResult from './ValidationResult';

const CheckboxFieldLayout = styled.div`
  padding: 0 0 10px 0;
  display: grid;
  grid-template-columns: min-content;
  grid-template-rows: min-content auto;

  label {
    display: grid;
    grid-template-columns: min-content min-content;
    grid-template-rows: auto;
    white-space: nowrap;
    grid-gap: 10px;
  }

  .CheckboxFieldLayout__validations {
    display: block;
    white-space: nowrap;
  }
`;

export default function CheckboxField({
  checkedValue,
  errors,
  field,
  label: labelText,
  submitted,
  touched,
}) {
  const id = useRef(uuid.v4());
  const { onBlur, onChangeValue, value = '' } = field;
  const onChange = useCallback(() => {
    const treatedValue = value || [];
    const hasValue = treatedValue.includes(checkedValue);
    const newValue = hasValue
      ? treatedValue.filter(val => val !== checkedValue)
      : treatedValue.concat(checkedValue);

    onChangeValue(newValue);
  }, [checkedValue, onChangeValue, value]);

  return (
    <CheckboxFieldLayout>
      <label htmlFor={id.current}>
        <span>{labelText}</span>
        <input
          id={id.current}
          type="checkbox"
          onBlur={onBlur}
          onChange={onChange}
          checked={(value || []).includes(checkedValue)}
        />
      </label>
      <div className="CheckboxFieldLayout__validations">
        {(submitted || touched) && <ValidationResult errors={errors} />}
      </div>
    </CheckboxFieldLayout>
  );
}


CheckboxField.defaultProps = {
  label: null,
  errors: []
};
```

## Using the CheckboxField

After building the Checkbox, see below how to use it.

```jsx
import React from 'react';
import styled from 'styled-components';
import { useFormFlowField } from 'react-form-flow';
import CheckboxField from './CheckboxField';

const CheckboxFieldRecipeLayout = styled.div``;

export default function CheckboxFieldRecipe() {
  const skillsField = useFormFlowField('skills', { eventType: 'value' });

  return (
    <CheckboxFieldRecipeLayout>
      <h2>Interact with the checkboxes below by clicking...</h2>
      <fieldset>
        <legend>Skills</legend>
        <CheckboxField {...skillsField} label="Reading" checkedValue="reading" />
        <CheckboxField {...skillsField} label="Strategic View" checkedValue="strategic_view" />
        <CheckboxField {...skillsField} label="Cooking" checkedValue="cooking" />
        <CheckboxField {...skillsField} label="Playing football" checkedValue="football" />
        <span>
          value:
          {JSON.stringify(skillsField.value)}
        </span>
      </fieldset>
    </CheckboxFieldRecipeLayout>
  );
}
```

And then...

```jsx
  import { FormFlowProvider } from 'react-form-flow';

  const initialData = { ... };
  const schemaData = { ... };

  // ...

  <FormFlowProvider initialData={initialData} schemaData={schemaData}>
    <CheckboxFieldRecipe />
  </FormFlowProvider>
```
