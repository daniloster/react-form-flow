import { Meta, Story, Canvas, Props } from '@storybook/addon-docs'

<Meta title="Docs/Recipes/useFormFlowField" component={() => <div />} />

# useFormFlowField

`react-form-flow` as its name describes is a library to define a common and automated workflow to collect and validate form data. Allow user to consume the data and validation based on the json path.

To improve your productivity, it would be good to create your core form components such as input, dropdowns and on and on following the `react-form-flow` spec.

_JSON PATH_ is a notation to navigate through the JSON object.

e.g.

```js
const data = {
    person: {
      id: 1,
      name: 'Jane Doe',
      email: 'jane@doe.dead'
      children:[
        {id: 2, name: 'John Doe'}
      ]
    }
};
```

So, observing the json above, the json path to access the name of first child is `"person.chidlren[0].name"`.

### ValidationResult

```jsx
import React from 'react';

export default function ValidationResult({ label, validations }) {
  return (
    <section>
      {!!label && <div>{label}</div>}
      {validations.map(({ key, isValid, message }) => !isValid && <div key={key}>{message}</div>)}
    </section>
  );
}
```

### InputField

The input field could receive from the `useFormFlowField` an object with the spec below.

```js
{
  field: {
    /* Function to update an object regarding the json path and value, only added if useFormFlowValidation('name', { eventType: "value" }) */
    onChangeValue /* onChangeValue(value: any) */,
    /* Function to handle input event "change", only added if useFormFlowValidation('name', { eventType: "event" }) */
    onChange /* onChange(event: Event) */,
    value /* any */,
  },
  errors  /* arrayOf(ValidationResult) */,
  submitted /* boolean */,
  touched /* boolean */,
}
```

Component...

```jsx
import React from 'react';
import ValidationResult from './ValidationResult';

export default function InputField(props) {
  const {
    errors,
    field,
    label: labelText,
    submitted,
    touched,
  } = props
  const id = useRef(uuid.v4());

  return (
    <div>
      <label htmlFor={id.current}>
        <span>{labelText}</span>
        <input id={id.current} type="text" {...field} />
      </label>
      <div className="InputFieldLayout__validations">
        {(submitted || touched) && <ValidationResult errors={errors} />}
      </div>
    </div>
  );
}

InputField.defaultProps = {
  value: '',
};
```

#### schemaData

```jsx
import { SchemaBuilder } from 'react-form-flow';

SchemaBuilder.factory("required", (metadata) => hasValue(metadata.value ?? ""));
SchemaBuilder.factory("min-length", ({ value }) => !hasValue(value ?? "") || (value ?? "").length >= min, {
  response: ({ value }) => ({ length: (value ?? "").length })
});

export default SchemaBuilder.builder()
  .with("name")
  .check("required", { message: "Name is required" })
  .check("min-length", { min: 5, message: "Name must be greater than 5 characters" })
  .end()
  .with("description")
  .check("required", { message: "Description is required" })
  .check("min-length", { min: 50, message: "Name must be greater than 50 characters" })
  .end()
```

#### App

A few things are required in order to use the `react-form-flow` library.

- initialData: the initial data to be rendered in the form
- schemaData: an object with validation rules per json path
- children: the react node being wrapped by the provider containing the real form within fields

```jsx
import React from 'react';
import styled from 'styled-components';
import {
  FormFlowProvider,
  useFormFlowField,
  useFormFlowValidation,
} from 'react-form-flow';
import ValidationResult from './ValidationResult';
import InputField from './InputField';
import schemaData from './schemaData';

const Layout = styled.div`
  height: 100%;
  width: 100%;

  display: grid;

  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto;
`;

function Validations() {
  const nameValidation = useFormFlowValidation('name');
  const descriptionValidation = useFormFlowField('description');

  return (
    <div>
      <ValidationResult label="Name" {...nameValidation} />
      <ValidationResult label="Description" {...descriptionValidation} />
    </div>
  );
}

function Form() {
  const nameField = useFormFlowField('name');
  const descriptionField = useFormFlowField('description');

  return (
    <div>
      <InputField label="Name" {...nameField} />
      <InputField label="Description" {...descriptionField} />
    </div>
  );
}

function DemoApp() {
  return (
    <Layout>
      <FormFlowProvider initialData={{ name: '', description: '' }} schemaData={schemaData}>
        <Validations />
        <Form />
      </FormFlowProvider>
    </Layout>
  );
}
```

Running...

```jsx
<DemoApp />
```
